<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Log Book Pertanian - Olah Tanah hingga Panen</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2c6e3c;
      --secondary: #3d8b55;
      --accent: #e67e22;
      --light: #e6f7e6;
      --dark: #245530;
      --warning: #e74c3c;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #f0f9eb, #e6f7e6);
      color: #333;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }
    
    header {
      text-align: center;
      padding: 20px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      color: white;
      border-radius: 15px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
      transform: rotate(30deg);
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 8px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
      position: relative;
    }
    
    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }
    
    .section-title {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e0f0e7;
    }
    
    .section-icon {
      background: linear-gradient(to bottom, var(--primary), var(--dark));
      color: white;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    
    h2 {
      color: var(--primary);
      font-size: 1.5rem;
    }
    
    h3 {
      color: var(--secondary);
      font-size: 1.3rem;
      margin: 20px 0 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed #d1e7dd;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary);
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #c2e0d0;
      border-radius: 10px;
      font-size: 16px;
      background: white;
      transition: all 0.3s;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(44, 110, 60, 0.2);
      outline: none;
    }
    
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 20px 0;
    }
    
    button {
      background: linear-gradient(to bottom, var(--primary), var(--dark));
      color: white;
      border: none;
      border-radius: 12px;
      padding: 16px 20px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
      flex: 1;
      min-width: 200px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button.secondary {
      background: linear-gradient(to bottom, #4a8da8, #3f7a91);
    }
    
    button.accent {
      background: linear-gradient(to bottom, var(--accent), #d35400);
    }
    
    button.warning {
      background: linear-gradient(to bottom, var(--warning), #c0392b);
    }
    
    .timeline-container {
      position: relative;
      padding: 40px 0;
      margin: 20px 0;
    }
    
    .timeline-container::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 4px;
      background: var(--primary);
      margin-left: -2px;
      border-radius: 2px;
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: 50px;
    }
    
    .timeline-item:nth-child(odd) {
      padding-right: 30px;
      padding-left: 0;
    }
    
    .timeline-item:nth-child(even) {
      padding-left: 30px;
      padding-right: 0;
    }
    
    .timeline-item::after {
      content: '';
      position: absolute;
      top: 20px;
      right: -10px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      border: 4px solid var(--primary);
      z-index: 1;
    }
    
    .timeline-item:nth-child(even)::after {
      left: -10px;
      right: auto;
    }
    
    .timeline-content {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      border-left: 5px solid var(--primary);
      position: relative;
    }
    
    .timeline-item:nth-child(even) .timeline-content {
      border-left: none;
      border-right: 5px solid var(--primary);
    }
    
    .timeline-date {
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .timeline-title {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: var(--dark);
    }
    
    .phase-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: bold;
      margin-right: 8px;
      font-size: 0.9rem;
    }
    
    .badge-prep {
      background-color: #8e44ad;
      color: white;
    }
    
    .badge-semai {
      background-color: #3498db;
      color: white;
    }
    
    .badge-vegetatif {
      background-color: #2ecc71;
      color: white;
    }
    
    .badge-generatif {
      background-color: #f39c12;
      color: white;
    }
    
    .badge-panen {
      background-color: #e74c3c;
      color: white;
    }
    
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      flex: 1;
      min-width: 200px;
    }
    
    .file-input-wrapper input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .json-container {
      margin-top: 20px;
      background: #f8f8f8;
      border-radius: 10px;
      padding: 15px;
    }
    
    textarea {
      width: 100%;
      height: 150px;
      padding: 15px;
      border: 2px solid #d1e7dd;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      resize: vertical;
      background: white;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.06);
    }
    
    .activity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .activity-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      border-left: 5px solid var(--primary);
      transition: all 0.3s;
    }
    
    .activity-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }
    
    .activity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e0f0e7;
    }
    
    .activity-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--dark);
    }
    
    .activity-date {
      font-size: 0.9rem;
      color: #666;
    }
    
    .activity-details {
      margin-top: 10px;
    }
    
    .activity-detail {
      display: flex;
      margin-bottom: 8px;
    }
    
    .detail-label {
      font-weight: 600;
      width: 120px;
      color: var(--primary);
    }
    
    .detail-value {
      flex: 1;
    }
    
    .nutrient-list {
      margin-top: 10px;
      padding-left: 20px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .empty-state i {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #c2e0d0;
    }
    
    .calendar-export {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border-left: 4px solid #1a73e8;
    }
    
    .calendar-export h4 {
      color: #1a73e8;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .imported-data {
      background: #e8f5e9;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      border-left: 4px solid var(--primary);
    }
    
    footer {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      color: #6c757d;
      font-size: 14px;
      border-top: 1px solid #e0f0e7;
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .timeline-container::before {
        left: 31px;
      }
      
      .timeline-item {
        padding-left: 70px !important;
        padding-right: 0 !important;
      }
      
      .timeline-item::after {
        left: 21px !important;
        right: auto !important;
      }
      
      .timeline-item:nth-child(odd) .timeline-content,
      .timeline-item:nth-child(even) .timeline-content {
        border-left: 5px solid var(--primary);
        border-right: none;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-book"></i> Log Book Pertanian</h1>
      <p>Olah Tanah, Semai, Perawatan, hingga Panen - Kompatibel untuk Tanah dan Hidroponik</p>
    </header>

    <div class="card">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-plus-circle"></i></div>
        <h2>Tambah Kegiatan Baru</h2>
      </div>
      
      <div class="form-row">
        <div>
          <div class="form-group">
            <label for="activityName"><i class="fas fa-tasks"></i> Nama Kegiatan</label>
            <input type="text" id="activityName" placeholder="Contoh: Pengolahan tanah, Penanaman, Pemupukan">
          </div>
          
          <div class="form-group">
            <label for="activityType"><i class="fas fa-seedling"></i> Jenis Kegiatan</label>
            <select id="activityType">
              <option value="persiapan">Persiapan Lahan</option>
              <option value="semai">Penyemaian</option>
              <option value="tanam">Penanaman</option>
              <option value="pemupukan">Pemupukan</option>
              <option value="pengairan">Pengairan/Penyiraman</option>
              <option value="pengendalian">Pengendalian Hama/Penyakit</option>
              <option value="perawatan">Perawatan Tanaman</option>
              <option value="panen">Panen</option>
              <option value="pasca">Pasca Panen</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="activityDate"><i class="fas fa-calendar"></i> Tanggal Kegiatan</label>
            <input type="date" id="activityDate">
          </div>
        </div>
        
        <div>
          <div class="form-group">
            <label for="growthPhase"><i class="fas fa-leaf"></i> Fase Pertumbuhan</label>
            <select id="growthPhase">
              <option value="persiapan">Persiapan</option>
              <option value="semai">Semai</option>
              <option value="vegetatif">Vegetatif</option>
              <option value="generatif">Generatif</option>
              <option value="panen">Panen</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="mediaType"><i class="fas fa-tint"></i> Media Tanam</label>
            <select id="mediaType">
              <option value="tanah">Tanah</option>
              <option value="hidroponik">Hidroponik</option>
              <option value="cocopeat">Cocopeat</option>
              <option value="rockwool">Rockwool</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="activityDesc"><i class="fas fa-file-alt"></i> Deskripsi Kegiatan</label>
            <textarea id="activityDesc" rows="3" placeholder="Detail kegiatan yang dilakukan"></textarea>
          </div>
        </div>
      </div>
      
      <div class="button-group">
        <button onclick="addActivity()"><i class="fas fa-plus"></i> Tambah Kegiatan</button>
        <button onclick="resetForm()" class="secondary"><i class="fas fa-redo"></i> Reset Form</button>
      </div>
    </div>
    
    <div class="card">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-file-import"></i></div>
        <h2>Import Data</h2>
      </div>
      
      <div class="form-row">
        <div>
          <div class="form-group">
            <label for="importFile"><i class="fas fa-file-upload"></i> Import Log Book (JSON)</label>
            <div class="file-input-wrapper">
              <button class="secondary"><i class="fas fa-file-import"></i> Pilih File Log Book</button>
              <input type="file" id="importFile" accept=".json" />
            </div>
          </div>
          
          <div id="importedLogData" class="imported-data" style="display: none;">
            <h3><i class="fas fa-check-circle"></i> Log Book Berhasil Diimpor</h3>
            <p><strong>Jumlah Kegiatan:</strong> <span id="importedActivityCount">0</span></p>
            <p><strong>Tanggal Terlama:</strong> <span id="importedEarliestDate">-</span></p>
            <p><strong>Tanggal Terbaru:</strong> <span id="importedLatestDate">-</span></p>
          </div>
        </div>
        
        <div>
          <div class="form-group">
            <label for="importPupuk"><i class="fas fa-flask"></i> Import Data Pupuk (dari Aplikasi Sebelumnya)</label>
            <div class="file-input-wrapper">
              <button class="secondary"><i class="fas fa-file-import"></i> Pilih Data Pupuk</button>
              <input type="file" id="importPupuk" accept=".json" />
            </div>
          </div>
          
          <div id="importedPupukData" class="imported-data" style="display: none;">
            <h3><i class="fas fa-check-circle"></i> Data Pupuk Berhasil Diimpor</h3>
            <p><strong>Volume Air:</strong> <span id="importedVolume">-</span> Liter</p>
            <p><strong>Fase Tanaman:</strong> <span id="importedFase">-</span></p>
            <p><strong>Total Pupuk:</strong> <span id="importedPupuk">-</span> gram</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-history"></i></div>
        <h2>Jadwal Kegiatan</h2>
      </div>
      
      <div class="button-group">
        <button onclick="exportJSON()" class="secondary"><i class="fas fa-file-export"></i> Export ke JSON</button>
        <button onclick="exportToCalendar()" class="accent"><i class="fab fa-google"></i> Export ke Google Calendar</button>
      </div>
      
      <div id="activitiesContainer">
        <div id="timelineView" class="timeline-container">
          <!-- Timeline view will be generated here -->
        </div>
        
        <div id="gridView" class="activity-grid">
          <!-- Grid view will be generated here -->
        </div>
      </div>
      
      <div class="calendar-export">
        <h4><i class="fab fa-google"></i> Export ke Google Calendar</h4>
        <p>Setelah mengekspor, Anda dapat mengimpor file .ics ke Google Calendar:</p>
        <ol>
          <li>Buka Google Calendar di komputer</li>
          <li>Di sebelah kanan, klik <strong>"Setelan"</strong> lalu <strong>"Impor & ekspor"</strong></li>
          <li>Di bagian "Impor", klik <strong>"Pilih file dari komputer"</strong> dan pilih file .ics</li>
          <li>Pilih kalender yang ingin Anda tambahkan acara imporan</li>
          <li>Klik <strong>"Impor"</strong></li>
        </ol>
      </div>
    </div>
    
    <div class="card">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-code"></i></div>
        <h2>Data JSON</h2>
      </div>
      
      <div class="json-container">
        <textarea id="jsonData" placeholder="Data JSON akan muncul di sini..."></textarea>
        <div class="button-group">
          <button onclick="copyJSON()" class="secondary"><i class="fas fa-copy"></i> Salin JSON</button>
          <button onclick="saveToLocal()" class="secondary"><i class="fas fa-save"></i> Simpan ke Browser</button>
          <button onclick="loadFromLocal()" class="secondary"><i class="fas fa-file-download"></i> Muat dari Browser</button>
        </div>
      </div>
    </div>
    
    <footer>
      <p><i class="fas fa-user"></i> Log Book Pertanian - Olah Tanah hingga Panen</p>
      <p><i class="fas fa-copyright"></i> Kompatibel untuk Tanah dan Hidroponik | Dikembangkan untuk Petani Indonesia</p>
    </footer>
  </div>
  
  <script>
    // Data kegiatan
    let activities = [];
    
    // Inisialisasi aplikasi
    function initApp() {
      // Set tanggal default ke hari ini
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('activityDate').value = today;
      
      // Muat data dari localStorage jika ada
      loadFromLocal();
      
      // Tambahkan event listener untuk import
      document.getElementById('importFile').addEventListener('change', importLogBook);
      document.getElementById('importPupuk').addEventListener('change', importPupukData);
    }
    
    // Format tanggal
    function formatDate(dateString) {
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('id-ID', options);
    }
    
    // Format fase pertumbuhan
    function formatGrowthPhase(phase) {
      const phases = {
        'persiapan': 'Persiapan',
        'semai': 'Semai',
        'vegetatif': 'Vegetatif',
        'generatif': 'Generatif',
        'panen': 'Panen'
      };
      return phases[phase] || phase;
    }
    
    // Format jenis kegiatan
    function formatActivityType(type) {
      const types = {
        'persiapan': 'Persiapan Lahan',
        'semai': 'Penyemaian',
        'tanam': 'Penanaman',
        'pemupukan': 'Pemupukan',
        'pengairan': 'Pengairan/Penyiraman',
        'pengendalian': 'Pengendalian Hama',
        'perawatan': 'Perawatan Tanaman',
        'panen': 'Panen',
        'pasca': 'Pasca Panen'
      };
      return types[type] || type;
    }
    
    // Tambah kegiatan baru
    function addActivity() {
      const name = document.getElementById('activityName').value;
      const type = document.getElementById('activityType').value;
      const date = document.getElementById('activityDate').value;
      const phase = document.getElementById('growthPhase').value;
      const media = document.getElementById('mediaType').value;
      const desc = document.getElementById('activityDesc').value;
      
      if (!name || !date) {
        alert('Nama kegiatan dan tanggal harus diisi!');
        return;
      }
      
      const activity = {
        id: Date.now(),
        name,
        type,
        date,
        phase,
        media,
        desc,
        pupukData: null
      };
      
      activities.push(activity);
      activities.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      renderActivities();
      updateJSON();
      resetForm();
      
      alert('Kegiatan berhasil ditambahkan!');
    }
    
    // Reset form
    function resetForm() {
      document.getElementById('activityName').value = '';
      document.getElementById('activityDesc').value = '';
      document.getElementById('activityDate').value = new Date().toISOString().split('T')[0];
    }
    
    // Render kegiatan
    function renderActivities() {
      const timelineContainer = document.getElementById('timelineView');
      const gridContainer = document.getElementById('gridView');
      
      timelineContainer.innerHTML = '';
      gridContainer.innerHTML = '';
      
      if (activities.length === 0) {
        timelineContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-seedling"></i>
            <h3>Belum Ada Kegiatan</h3>
            <p>Tambahkan kegiatan pertama Anda untuk memulai log book</p>
          </div>
        `;
        
        gridContainer.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-seedling"></i>
            <h3>Belum Ada Kegiatan</h3>
            <p>Tambahkan kegiatan pertama Anda untuk memulai log book</p>
          </div>
        `;
        return;
      }
      
      // Timeline view
      activities.forEach((activity, index) => {
        const badgeClass = `badge-${activity.phase}`;
        const phaseName = formatGrowthPhase(activity.phase);
        
        timelineContainer.innerHTML += `
          <div class="timeline-item">
            <div class="timeline-content">
              <div class="timeline-date">
                <i class="fas fa-calendar"></i> ${formatDate(activity.date)}
              </div>
              <div class="timeline-title">
                <span class="phase-badge ${badgeClass}">${phaseName}</span> 
                ${activity.name}
              </div>
              <p><strong>Jenis:</strong> ${formatActivityType(activity.type)}</p>
              <p><strong>Media:</strong> ${activity.media}</p>
              ${activity.desc ? `<p>${activity.desc}</p>` : ''}
              ${activity.pupukData ? `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd;">
                  <h4><i class="fas fa-flask"></i> Data Pupuk Terkait</h4>
                  <p><strong>Volume Air:</strong> ${activity.pupukData.volumeAir} L</p>
                  <p><strong>Total Pupuk:</strong> ${activity.pupukData.totalGram} g</p>
                </div>
              ` : ''}
              <button onclick="deleteActivity(${activity.id})" class="warning" style="margin-top: 15px; padding: 8px 15px; font-size: 14px;">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </div>
        `;
      });
      
      // Grid view
      activities.forEach(activity => {
        const badgeClass = `badge-${activity.phase}`;
        const phaseName = formatGrowthPhase(activity.phase);
        
        gridContainer.innerHTML += `
          <div class="activity-card">
            <div class="activity-header">
              <div class="activity-title">
                <span class="phase-badge ${badgeClass}">${phaseName}</span> 
                ${activity.name}
              </div>
              <div class="activity-date">${formatDate(activity.date)}</div>
            </div>
            
            <div class="activity-details">
              <div class="activity-detail">
                <div class="detail-label">Jenis Kegiatan</div>
                <div class="detail-value">${formatActivityType(activity.type)}</div>
              </div>
              
              <div class="activity-detail">
                <div class="detail-label">Media Tanam</div>
                <div class="detail-value">${activity.media}</div>
              </div>
              
              ${activity.desc ? `
                <div class="activity-detail">
                  <div class="detail-label">Deskripsi</div>
                  <div class="detail-value">${activity.desc}</div>
                </div>
              ` : ''}
              
              ${activity.pupukData ? `
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd;">
                  <h4><i class="fas fa-flask"></i> Data Pupuk</h4>
                  <div class="activity-detail">
                    <div class="detail-label">Volume Air</div>
                    <div class="detail-value">${activity.pupukData.volumeAir} L</div>
                  </div>
                  <div class="activity-detail">
                    <div class="detail-label">Total Pupuk</div>
                    <div class="detail-value">${activity.pupukData.totalGram} g</div>
                  </div>
                  <div class="activity-detail">
                    <div class="detail-label">Fase Tanaman</div>
                    <div class="detail-value">${activity.pupukData.faseTanaman}</div>
                  </div>
                </div>
              ` : ''}
            </div>
            
            <button onclick="deleteActivity(${activity.id})" class="warning" style="margin-top: 15px; width: 100%; padding: 8px 15px; font-size: 14px;">
              <i class="fas fa-trash"></i> Hapus Kegiatan
            </button>
          </div>
        `;
      });
    }
    
    // Hapus kegiatan
    function deleteActivity(id) {
      if (confirm('Apakah Anda yakin ingin menghapus kegiatan ini?')) {
        activities = activities.filter(activity => activity.id !== id);
        renderActivities();
        updateJSON();
      }
    }
    
    // Update JSON data
    function updateJSON() {
      document.getElementById('jsonData').value = JSON.stringify(activities, null, 2);
    }
    
    // Salin JSON
    function copyJSON() {
      const jsonTextarea = document.getElementById('jsonData');
      jsonTextarea.select();
      document.execCommand('copy');
      alert('JSON telah disalin ke clipboard!');
    }
    
    // Simpan ke localStorage
    function saveToLocal() {
      localStorage.setItem('farmLogBook', JSON.stringify(activities));
      alert('Data berhasil disimpan di browser Anda!');
    }
    
    // Muat dari localStorage
    function loadFromLocal() {
      const savedData = localStorage.getItem('farmLogBook');
      if (savedData) {
        try {
          activities = JSON.parse(savedData);
          activities.sort((a, b) => new Date(a.date) - new Date(b.date));
          renderActivities();
          updateJSON();
        } catch (e) {
          console.error('Error loading data:', e);
        }
      }
    }
    
    // Export ke JSON
    function exportJSON() {
      const dataStr = JSON.stringify(activities, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      const exportFileName = 'log_book_pertanian.json';
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileName);
      document.body.appendChild(linkElement);
      linkElement.click();
      document.body.removeChild(linkElement);
    }
    
    // Import log book
    function importLogBook(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedActivities = JSON.parse(e.target.result);
          
          if (Array.isArray(importedActivities)) {
            activities = importedActivities;
            activities.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderActivities();
            updateJSON();
            
            // Tampilkan info import
            const earliestDate = activities.length ? new Date(activities[0].date).toLocaleDateString() : '-';
            const latestDate = activities.length ? new Date(activities[activities.length-1].date).toLocaleDateString() : '-';
            
            document.getElementById('importedActivityCount').textContent = activities.length;
            document.getElementById('importedEarliestDate').textContent = earliestDate;
            document.getElementById('importedLatestDate').textContent = latestDate;
            document.getElementById('importedLogData').style.display = 'block';
            
            alert(`Berhasil mengimpor ${activities.length} kegiatan!`);
          } else {
            throw new Error('Format file tidak valid');
          }
        } catch (err) {
          alert('Gagal mengimpor log book: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    // Import data pupuk
    function importPupukData(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const pupukData = JSON.parse(e.target.result);
          
          // Pastikan ini data dari aplikasi pupuk
          if (pupukData.volumeAir && pupukData.hasil) {
            // Tampilkan info pupuk
            document.getElementById('importedVolume').textContent = pupukData.volumeAir + ' Liter';
            
            // Format fase tanaman
            let fase = pupukData.faseTanaman;
            if (fase.includes("semai")) fase = "Semai";
            else if (fase.includes("vegetatif")) fase = "Vegetatif";
            else if (fase.includes("generatif")) fase = "Generatif";
            else fase = pupukData.faseTanaman;
            
            document.getElementById('importedFase').textContent = fase;
            document.getElementById('importedPupuk').textContent = pupukData.hasil.totalGram + ' g';
            document.getElementById('importedPupukData').style.display = 'block';
            
            // Cari kegiatan pemupukan terbaru untuk ditambahkan data pupuk
            const pemupukanActivities = activities.filter(a => a.type === 'pemupukan');
            if (pemupukanActivities.length > 0) {
              const latestPemupukan = pemupukanActivities.reduce((latest, current) => 
                new Date(current.date) > new Date(latest.date) ? current : latest
              );
              
              if (confirm('Tambahkan data pupuk ke kegiatan pemupukan terbaru?')) {
                latestPemupukan.pupukData = {
                  volumeAir: pupukData.volumeAir,
                  faseTanaman: fase,
                  totalGram: pupukData.hasil.totalGram
                };
                
                renderActivities();
                updateJSON();
                alert('Data pupuk berhasil ditambahkan ke kegiatan pemupukan!');
              }
            } else {
              alert('Tidak ditemukan kegiatan pemupukan. Silakan tambahkan kegiatan pemupukan terlebih dahulu.');
            }
          } else {
            throw new Error('Format data pupuk tidak valid');
          }
        } catch (err) {
          alert('Gagal mengimpor data pupuk: ' + err.message);
        }
      };
      reader.readAsText(file);
    }
    
    // Export ke Google Calendar (format .ics)
    function exportToCalendar() {
      if (activities.length === 0) {
        alert('Tidak ada kegiatan untuk diekspor!');
        return;
      }
      
      // Buat konten file .ics
      let icsContent = "BEGIN:VCALENDAR\n";
      icsContent += "VERSION:2.0\n";
      icsContent += "PRODID:-//FarmLogBook//ID\n";
      icsContent += "CALSCALE:GREGORIAN\n";
      icsContent += "METHOD:PUBLISH\n";
      
      activities.forEach(activity => {
        const startDate = activity.date.replace(/-/g, '');
        const uid = `${activity.id}@farmlogbook`;
        const summary = `${formatActivityType(activity.type)}: ${activity.name}`;
        const description = `Fase: ${formatGrowthPhase(activity.phase)}\nMedia: ${activity.media}\n${activity.desc || ''}`;
        
        icsContent += "BEGIN:VEVENT\n";
        icsContent += `DTSTART:${startDate}\n`;
        icsContent += `DTEND:${startDate}\n`;
        icsContent += `SUMMARY:${summary}\n`;
        icsContent += `DESCRIPTION:${description.replace(/\n/g, '\\n')}\n`;
        icsContent += `UID:${uid}\n`;
        icsContent += "SEQUENCE:0\n";
        icsContent += "STATUS:CONFIRMED\n";
        icsContent += "TRANSP:TRANSPARENT\n";
        icsContent += "END:VEVENT\n";
      });
      
      icsContent += "END:VCALENDAR";
      
      // Buat file download
      const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', 'jadwal_pertanian.ics');
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Jalankan inisialisasi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>